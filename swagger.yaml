openapi: 3.0.0
info:
  title: Express Backend API
  description: OpenAPI 3.0 specification reflecting the precise implementation of the actual Express application logic.
  version: 1.0.0
servers:
  - url: /api
    description: Base URL (API Routes are prefixed under /api in the Express app, but documented without it as requested, except for /api/health which bounds directly).

tags:
  - name: Auth
    description: Authentication endpoints
  - name: User
    description: User management and details
  - name: Admin
    description: Admin operations
  - name: Reward
    description: Reward-related endpoints
  - name: Audit
    description: Audit logs for admin tracking
  - name: System
    description: System health and utilities

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "INTERNAL_SERVER_ERROR"

    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: "Validation error message"

    User:
      type: object
      properties:
        id:
          type: string
          example: "60d0fe4f5311236168a109ca"
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          example: "john@example.com"
        role:
          type: string
          example: "user"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time

    Wallet:
      type: object
      properties:
        id:
          type: string
          example: "60d0fe4f5311236168a109cb"
        user:
          type: string
          example: "60d0fe4f5311236168a109ca"
        balance:
          type: number
          example: 100
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Transaction:
      type: object
      properties:
        id:
          type: string
          example: "60d0fe4f5311236168a109cc"
        user:
          type: string
          example: "60d0fe4f5311236168a109ca"
        type:
          type: string
          enum: [CREDIT, DEBIT]
          example: "CREDIT"
        amount:
          type: number
          example: 50
        reason:
          type: string
          example: "Daily Reward"
        source:
          type: string
          enum: [system, admin, reward]
          example: "reward"
        createdAt:
          type: string
          format: date-time

    AuditLog:
      type: object
      properties:
        id:
          type: string
          example: "60d0fe4f5311236168a109cd"
        adminId:
          type: string
        action:
          type: string
          example: "USER_STATUS_UPDATE"
        targetedUserId:
          type: string
        oldValue:
          type: object
        newValue:
          type: object
        ipAddress:
          type: string
          example: "192.168.1.1"
        userAgent:
          type: string
        createdAt:
          type: string
          format: date-time

  responses:
    TooManyRequests:
      description: Too Many Requests - Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

paths:
  /health:
    get:
      tags:
        - System
      summary: Health Check
      security: []
      responses:
        "200":
          description: Server Health Status
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Server is running"
                  timestamp:
                    type: string
                    format: date-time

  /login-web:
    post:
      tags:
        - Auth
      summary: Web Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: "john@example.com"
                password:
                  type: string
                  example: "password123"
      responses:
        "200":
          description: Login successful (Web)
          headers:
            Set-Cookie:
              description: HttpOnly refresh token cookie
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "LOGIN_SUCCESS"
                  accessToken:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "INVALID_REQUEST"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "INVALID_CREDENTIALS"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "ACCOUNT_DISABLED"
        "429":
          description: Too Many Requests

  /login-mobile:
    post:
      tags:
        - Auth
      summary: Mobile Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: "john@example.com"
                password:
                  type: string
                  example: "password123"
      responses:
        "200":
          description: Login successful (Mobile)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "LOGIN_SUCCESS"
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "429":
          description: Too Many Requests

  /register:
    post:
      tags:
        - Auth
      summary: Register a new user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                confirmPassword:
                  type: string
      responses:
        "201":
          description: Registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Verification Email sent to your Email Address. Please verify your email to activate your account"
                  email:
                    type: string
                  verifyToken:
                    type: string
                    description: Only included if EXPOSE_VERIFY_TOKEN is true
        "400":
          description: Validation Error or Resent verification
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email Already Registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /verify-email/{token}:
    get:
      tags:
        - Auth
      summary: Verify User Email
      security: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Email verified successfully"
        "400":
          description: Invalid Token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /resend-verification:
    post:
      tags:
        - Auth
      summary: Resend verification email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
      responses:
        "200":
          description: Email resent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "VERIFICATION_EMAIL_RESENT"
        "400":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email Already Verified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /refresh:
    post:
      tags:
        - Auth
      summary: Refresh Access Token
      description: |
        For web: reads refresh token from HttpOnly cookie and returns new access token.
        For mobile: expects refresh token in request body and returns both tokens.
      security: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        "200":
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "TOKEN_REFRESHED"
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
        "400":
          description: Account Disabled / Token Reuse
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Invalid Refresh Token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /forgot-password:
    post:
      tags:
        - Auth
      summary: Request Password Reset
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
      responses:
        "200":
          description: Reset link sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Reset link sent successfully"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /reset-password/{token}:
    post:
      tags:
        - Auth
      summary: Reset Password
      security: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newPassword:
                  type: string
      responses:
        "200":
          description: Password updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password updated successfully"
        "400":
          description: Token Invalid Or Expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /logout:
    post:
      tags:
        - Auth
      summary: Logout User
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User Logged Out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "USER_LOGGED_OUT"
                  user:
                    type: string
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/me:
    get:
      tags:
        - User
      summary: Get Current User Profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User Profile Details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User profile details:"
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /user/wallet:
    get:
      tags:
        - User
      summary: Get User Wallet Details
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User Wallet Details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User WalletDetails"
                  data:
                    $ref: "#/components/schemas/Wallet"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/transactions:
    get:
      tags:
        - User
      summary: Get User Transactions
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
        - in: query
          name: start
          schema:
            type: string
            format: date
        - in: query
          name: end
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Transaction History
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User transaction history"
                  data:
                    type: object
                    properties:
                      transactions:
                        type: array
                        items:
                          $ref: "#/components/schemas/Transaction"
                      total:
                        type: integer
                      page:
                        type: integer
                      limit:
                        type: integer
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/referral:
    get:
      tags:
        - User
      summary: Get Referral Details
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User Referral Details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User referral details"
                  data:
                    type: object
                    properties:
                      referralCode:
                        type: string
                      referredUsers:
                        type: array
                        items:
                          $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/update:
    put:
      tags:
        - User
      summary: Update Current User Profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
      responses:
        "200":
          description: User Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User updated"
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/delete:
    delete:
      tags:
        - User
      summary: Delete User
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User Deleted"
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /admin/dashboard/stats:
    get:
      tags:
        - Admin
      summary: Get Admin Dashboard Stats
      description: Requires admin role.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Dashboard Statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "DASHBOARD STATS"
                  totalUsers:
                    type: integer
                  activeUsers:
                    type: integer
                  totalWalletsBalance:
                    type: number
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /admin/me:
    get:
      tags:
        - Admin
      summary: Admin Current Details
      description: Requires admin role.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current Details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Current details"
                  data:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /admin/users:
    get:
      tags:
        - Admin
      summary: Get All Users
      description: Requires admin role.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Get all active users
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "ALL_ACTIVE_USERS"
                  user:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /users/by-name/{name}:
    get:
      tags:
        - Admin
      summary: Get user by name
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User Object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User Name Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /admin/wallet/summary:
    get:
      tags:
        - Admin
      summary: Wallet Summary
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: date
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Wallet Summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "WALLET_SUMMARY"
                  totalBalance:
                    type: number
                  transactionsCount:
                    type: integer
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /admin/wallet/summary/range:
    get:
      tags:
        - Admin
      summary: Get Wallet Summary in Range
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date
        - in: query
          name: end
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        "200":
          description: Wallet Transactions Range
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "WALLET_TRANSACTIONS"
                  transactions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Transaction"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /admin/users/{id}:
    get:
      tags:
        - Admin
      summary: Get User By Id
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User Details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "USER_DETAILS_BY_ID"
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /admin/users/{id}/wallet:
    get:
      tags:
        - Admin
      summary: Get User Wallet
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: query
          name: pageNum
          schema:
            type: integer
        - in: query
          name: limitNum
          schema:
            type: integer
      responses:
        "200":
          description: User wallet details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "USER_WALLET_DETAILS"
                  wallet:
                    $ref: "#/components/schemas/Wallet"
                  transactions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Transaction"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"
    patch:
      tags:
        - Admin
      summary: Adjust Wallet Balance
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                type:
                  type: string
                  enum: [CREDIT, DEBIT]
                reason:
                  type: string
      responses:
        "200":
          description: Balance Adjusted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "WALLET_CREDITED"
                  wallet:
                    $ref: "#/components/schemas/Wallet"
                  transaction:
                    $ref: "#/components/schemas/Transaction"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /admin/users/{id}/status:
    patch:
      tags:
        - Admin
      summary: Update User Status
      description: Requires admin role.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isActive:
                  type: boolean
      responses:
        "200":
          description: User Status Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "USER_ACTIVATED"
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /audit-logs:
    get:
      tags:
        - Audit
      summary: Get Audit Logs
      description: Requires admin role.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Audit Logs List
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "AUDIT LOGS:"
                  logs:
                    type: array
                    items:
                      $ref: "#/components/schemas/AuditLog"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /recent/audit:
    get:
      tags:
        - Audit
      summary: Get Recent Activities
      description: Requires admin role.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Recent Activity
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "RECENT_ACTIVITY"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/AuditLog"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Role not allowed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /reward/daily-reward:
    post:
      tags:
        - Reward
      summary: Claim Daily Reward
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Reward Status Claimed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Daily reward claimed successfully"
                  transaction:
                    $ref: "#/components/schemas/Transaction"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Already Rewarded Today
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"